<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CHEMEC Scientific</title>
  <link rel="stylesheet" href="css/style-rtl.css" />
  <link rel="icon" type="image/png" href="images/logo-placeholder.png" />
  <link rel="apple-touch-icon" href="images/logo-placeholder.png" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <div class="loading-spinner" id="loadingSpinner">
      <img src="images/spinner.gif" alt="Loading..." />
  </div>
  <script src="js/firebase-config.js"></script>
  <script src="js/data.js"></script>
  <script src="js/navbar.js"></script>
  <script src="js/main.js"></script>

  <section class="search-results-page">
    <div class="container">
      <div class="page-header">
        <h1 id="search-results-title">Search Results</h1>
        <p id="search-results-description"></p>
      </div>
      <div class="search-info" id="search-info">
        <div class="search-stats">
          <span id="results-count">0</span> results
        </div>
        <div class="search-query">
          for: "<span id="search-query-text"></span>"
        </div>
      </div>
      <div id="search-results-container" class="products-grid"></div>
      <div id="no-results" class="no-results-message" style="display: none;">
        <div class="no-results-icon">üîç</div>
        <h3>No results</h3>
        <p>We couldn't find any products matching your query.</p>
        <a href="products.html" class="cta-button">Browse all products</a>
      </div>
      <div class="text-center" id="back-to-products" style="display: none;">
        <a href="products.html" class="cta-button secondary">Back to products</a>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', async function() {
      await loadSearchResults();
    });

    async function loadSearchResults() {
      const urlParams = new URLSearchParams(window.location.search);
      const searchQuery = urlParams.get('q');
      if (!searchQuery) {
        window.location.href = 'products.html';
        return;
      }
      document.getElementById('search-query-text').textContent = searchQuery;
      document.getElementById('search-results-description').textContent = `Results for "${searchQuery}"`;

      if (!window.dataManager) return;
      try {
        const products = await window.dataManager.getProductsFromFirestore();
        const filtered = products.filter(p => 
          (p.name||'').toLowerCase().includes(searchQuery.toLowerCase()) ||
          (p.description||'').toLowerCase().includes(searchQuery.toLowerCase()) ||
          (p.specs||'').toLowerCase().includes(searchQuery.toLowerCase()) ||
          (p.categoryId||'').toString().includes(searchQuery)
        );
        displaySearchResults(filtered);
      } catch (e) {
        document.getElementById('search-results-container').innerHTML = '<p>Error loading search results.</p>';
      }
    }

    function displaySearchResults(products) {
      const container = document.getElementById('search-results-container');
      const noResults = document.getElementById('no-results');
      const searchInfo = document.getElementById('search-info');
      const backButton = document.getElementById('back-to-products');
      const resultsCount = document.getElementById('results-count');

      resultsCount.textContent = products.length;

      if (products.length === 0) {
        container.style.display = 'none';
        noResults.style.display = 'block';
        backButton.style.display = 'block';
        return;
      }

      container.style.display = 'grid';
      noResults.style.display = 'none';
      backButton.style.display = 'block';
      searchInfo.style.display = 'block';

      container.innerHTML = products.map(product => `
        <div class="product-card" onclick="window.location.href='category.html?categoryId=${product.categoryId}'">
          <img src="${product.image || 'https://via.placeholder.com/400'}" alt="${product.name}" onerror="this.src='https://via.placeholder.com/400'">
          <h3>${product.name}</h3>
          <p>${product.description || ''}</p>
          ${product.specs ? `<div class="specs">${product.specs.replace(/\n/g, '<br>')}</div>` : ''}
          <div class="price">${product.price || 'Contact for price'}</div>
        </div>
      `).join('');
    }
  </script>

  <script>
    function hideLoadingSpinner() {
      const spinner = document.getElementById('loadingSpinner');
      if (spinner) spinner.style.display = 'none';
    }
    setTimeout(hideLoadingSpinner, 8000);
  </script>
</body>
</html>
